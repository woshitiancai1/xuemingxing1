var $menubar = function () {var o, c = $('<div class="notepad-menubar"></div>'),
d = [], r = -1;function e() {!function () {
for (var t = $('<ul class="menu-title"></ul>'), e = 0; e < o.length; e++) {var n = $('<li class="title"></li>');n.html(o[e].title),
n.attr("data-id", e),t.append(n),n.click(function (t) {var e = Number(this.dataset.id);
r = -1 === r ? (d[e].css({ display: "inline-block" }), e) : r !== e ? (d[r].css({ display: "none" }), d[e].css({ display: "inline-block" }), e) : (d[r].css({ display: "none" }), -1), t.stopPropagation()
}), n.hover(function () { if (-1 !== r) { var t = Number(this.dataset.id); d[r].css({ display: "none" }), d[t].css({ display: "inline-block" }), r = t } })} c.append(t)
}(), function () { for (var t = 0; t < o.length; t++) { for (var e = $('<ul class="menus"></ul>'), n = o[t].menuItems, l = 0; l < n.length; l++)if ("hr" !== n[l].title) { var a = $('<li class="menu-item"></li>'); if (a.html(n[l].title), a.attr("data-x", t), a.attr("data-y", l), "" !== n[l].shortcut) { var i = $('<span class="shortcut"></span>'); i.html(n[l].shortcut), a.append(i) } n[l].enabled || a.addClass("disabled"), e.append(a), a.click(function (t) { if (t.stopPropagation(), !$(this).hasClass("disabled")) { var e = this.dataset.x, n = this.dataset.y; d[e].css({ display: "none" }), r = -1, o[e].menuItems[n].handler() } }) } else { var s = $('<li class="menu-hr"></li>'); e.append(s) } e.css({ width: o[t].width, left: o[t].left, display: "none" }), c.append(e), d.push(e) } }(), $("body").append(c)
} return { show: function (t) { o = t, e() }, checked: function (t, e, n) { var l = d[t].find(".menu-item")[e]; n ? $(l).prepend($('<span class="checked">✓</span>')[0]) : $(l).find(".checked").remove() }, enabled: function (t, e, n) { var l = d[t].find(".menu-item")[e]; n ? $(l).removeClass("disabled") : $(l).addClass("disabled") }, hideMenu: function () { -1 !== r && (d[r].css({ display: "none" }), r = -1) } }
}(), $editor = function () { var e = $('<div class="notepad-editor"><textarea spellcheck="false" auto-size="none"></textarea></div>'), i = e.find("textarea"), s = { posHandler: null, contentHandler: null, wrap: !1 }, t = !1; function o() { var t = i.val().substr(0, i[0].selectionStart).split("\n"); return t[t.length - 1].length + 1 } function c() { return i.val().substr(0, i[0].selectionStart).split("\n").length } function n(t) { t ? (i.attr("wrap", "soft"), i.css({ "overflow-x": "hidden" })) : (i.attr("wrap", "off"), i.css({ "overflow-x": "scroll" })) } return i.keyup(function () { s.posHandler(c(), o()), s.contentHandler("" !== i.val()) }), i.keypress(function () { s.posHandler(c(), o()) }), i.mousedown(function () { t = !0 }), i.mouseup(function () { t = !1 }), i.mousemove(function () { t && s.posHandler(c(), o()) }), i.click(function () { s.posHandler(c(), o()) }), { show: function (t) { $.extend(s, t), $("body").append(e), i.trigger("focus"), n(s.wrap) }, resize: function (t) { t ? e.css({ bottom: "21px" }) : e.css({ bottom: "0" }) }, focus: function () { i.focus() }, getTotalLn: function () { return i.val().split("\n").length }, getRow: c, getCol: o, setWrap: n, selectAll: function () { var t = i.val().length; i[0].selectionStart = 0, i[0].selectionEnd = t, i.select() }, insertDataTime: function () { var t = i.val(), e = t.substring(0, i[0].selectionStart), n = t.substring(i[0].selectionEnd, t.length); t = e + (new Date).toLocaleString() + n, i.val(t), i.focus(), s.posHandler(c(), o()) }, gotoLn: function (t) { for (var e = 0, n = i.val().split("\n"), l = 0; l < t - 1; l++)e += n[l].length + 1; i[0].selectionStart = e, i[0].selectionEnd = e, i.focus(), s.posHandler(c(), o()) }, bingSearch: function () { var t = i[0].selectionStart, e = i[0].selectionEnd; if (t === e) window.open("https://cn.bing.com/", "_blank"); else { var n = i.val().substring(t, e); window.open("https://cn.bing.com/search?q=" + n, "_blank") } }, search: function (t) { var e = i.val(), n = t.content; t.capitalSense || (e = e.toLowerCase(), n = n.toLowerCase()); var l, a = i[0].selectionEnd; l = "down" === t.direction ? e.indexOf(n, a) : e.substr(0, i[0].selectionStart).lastIndexOf(n), -1 !== l ? (i[0].selectionStart = l, i[0].selectionEnd = l + n.length, s.posHandler(c(), o())) : alert('找不到 "' + t.content + '"') }, setFont: function (t) { i.css({ "font-family": t.family, "font-size": t.size + "pt" }), "斜体" !== t.style ? "粗体" !== t.style ? "粗偏斜体" !== t.style || i.css({ "font-weight": "bold", "font-style": "italic" }) : i.css({ "font-weight": "bold" }) : i.css({ "font-style": "italic" }) } } }(), $statusBar = function () { var e = $('<div class="notepad-statusbar"><div class="left-panel"></div><div class="right-panel"><p class="row-col"></p></div></div>'), n = e.find(".row-col"), l = "第&nbsp;x&nbsp;行，第&nbsp;y&nbsp;列", a = { row: 1, col: 1 }; function i(t, e) { n.html(l.replace("x", t).replace("y", e)) } return { init: function (t) { $.extend(a, t), i(a.row, a.col), $("body").append(e) }, setRowCol: i, display: function (t) { t ? e.css("display", "block") : e.css("display", "none") } } }(), $dlgAbout = function () { }(); function comList() { var a, n = $('<div class="notepad-com-list"><input class="editor" type="text"><br><ul class="list"></ul></div>'), l = n.find(".editor"), i = n.find(".list"), s = { container: "", list: [], select: 0, width: "200px", isFont: !1, isFontStyle: !1, selectHandler: null }; function e() { var t, e = $(s.container).find(".notepad-com-list"); 0 !== e.length && e.remove(), $(s.container).append(n), n.css({ width: s.width }), function () { var t, e, n, l = 0; if (s.isFont) for (l = 0; l < s.list.length; l++)(t = $('<li class="item"></li>')).css({ "font-family": s.list[l] }), i.append(t.html(s.list[l])); else if (s.isFontStyle) for (l = 0; l < s.list.length; l++)t = $('<li class="item"></li>'), e = t, "斜体" !== (n = s.list[l]) ? "粗体" !== n ? "粗偏斜体" !== n || e.css({ "font-weight": "bold", "font-style": "italic" }) : e.css({ "font-weight": "bold" }) : e.css({ "font-style": "italic" }), i.append(t.html(s.list[l])); else for (l = 0; l < s.list.length; l++)t = $('<li class="item"></li>'), i.append(t.html(s.list[l])); a = i.find(".item") }(), t = s.select, $(a[t]).addClass("selected"), l.val(s.list[t]), l.select() } this.show = function (t) { $.extend(s, t), e(), i.click(function (t) { $(a[s.select]).removeClass("selected"), s.select = s.list.indexOf($(t.target).html()), $(a[s.select]).addClass("selected"), l.val(s.list[s.select]), l.select(), s.selectHandler(s.select) }), l.keyup(function () { var t = 0; for (t = 0; t < s.list.length && 0 !== s.list[t].indexOf(l.val()); t++); t !== s.list.length && (a[t].scrollIntoView({ behavior: "smooth", block: "start" }), $(a[s.select]).removeClass("selected"), $(a[t]).addClass("selected"), s.select = t) }) } } var $dlgFont = function () { var e = $('<div class="notepad-dlg-mask notepad-dlg-font"><div class="dialogbox notepad-dlgbox"><div class="notepad-dlg-titlebar"><p class="title">字体</p><span class="close-btn" title="关闭">✖</span></div><div class="main notepad-dlg-main"><div class="font-family"><p>字体(F):</p></div><div class="font-style"><p>字形(Y):</p></div><div class="font-size"><p>大小(S):</p></div><fieldset class="sample"><legend>示例</legend><p class="sample-txt">AaBbYyZz</p></fieldset><div class="script"><label>脚本语言(R):<br><select><option value="中文">中文</option><option value="中文 GB2312">中文 GB2312</option></select></label></div><input class="btn-ok btn" type="button" value="确定"><input class="btn-cancel btn" type="button" value="取消"></div></div></div>'), n = e.find(".btn-ok"), l = e.find(".close-btn"), a = e.find(".btn-cancel"), t = e.find(".sample-txt"), i = e.find(".notepad-dlg-titlebar"), s = ["黑体","宋体","微软雅黑","楷体","Arial","Bahnschrift"], o = ["常规", "斜体", "粗体", "粗偏斜体"], c = ["8", "9", "10", "11", "12", "14", "16", "18", "20", "22", "24", "26", "28", "36", "48", "72"], d = { family: "Arial", style: "常规", size: "16", okHandler: null }; function r() { t.css({ "font-family": d.family, "font-size": d.size + "pt" }), "斜体" !== d.style ? "粗体" !== d.style ? "粗偏斜体" !== d.style || t.css({ "font-weight": "bold", "font-style": "italic" }) : t.css({ "font-weight": "bold" }) : t.css({ "font-style": "italic" }) } function u() { e.remove() } return { show: function (t) { $.extend(d, t), $("body").append(e), (new comList).show({ container: ".notepad-dlg-font .font-family", width: "176px", list: s, select: s.indexOf(d.family), isFont: !0, selectHandler: function (t) { d.family = s[t], r() } }), (new comList).show({ container: ".notepad-dlg-font .font-style", width: "132px", list: o, select: o.indexOf(d.style), isFontStyle: !0, selectHandler: function (t) { d.style = o[t], r() } }), (new comList).show({ container: ".notepad-dlg-font .font-size", width: "64px", list: c, select: c.indexOf(d.size), selectHandler: function (t) { d.size = c[t], r() } }), r(), e.find(".dialogbox").draggable({ handle: i }), l.click(u), a.click(u), n.click(function () { d.okHandler({ family: d.family, style: d.style, size: d.size }), u() }), e.click(function (t) { t.stopPropagation() }) } } }(), $dlgGoto = function () { }(), $dlgReplace = function () { }(), $dlgSearch = function () { }(), np = { config: { appContainer: ".notepad-app" }, bShowStatusBar: !1, bWrap: !1, fontFamily: "Arial", fontStype: "常规", fontSize: "16", fontHandler: function (t) { np.fontFamily = t.family, np.fontStype = t.style, np.fontSize = t.size, $editor.setFont(t) } }; $(function () { $menubar.show(np.menuData), $editor.show({ posHandler: function (t, e) { $statusBar.setRowCol(t, e) }, contentHandler: function (t) { $menubar.enabled(1, 6, t) } }), $editor.setFont({ family: np.fontFamily, style: np.fontStype, size: np.fontSize }), $statusBar.init(), $statusBar.display(!1), $("body").click(function () { $menubar.hideMenu(), $editor.focus() }) }), np.menuData = [{ title: "文件(F)", menuItems: [{ title: "新建(N)", shortcut: "Ctrl+N", enabled: !0, handler: function () { console.log("新建(N) menu clicked!") } }, { title: "打开(O)...", shortcut: "Ctrl+O", enabled: !0, handler: function () { console.log("打开(O) menu clicked!") } }, { title: "保存(S)", shortcut: "Ctrl+S", enabled: !0, handler: function () { console.log("保存(S) menu clicked!") } }, { title: "另存为(A)...", shortcut: "", enabled: !0, handler: function () { console.log("另存为(A) menu clicked!") } }, { title: "hr", shortcut: "", enabled: !0, handler: null }, { title: "页面设置(U)...", shortcut: "", enabled: !0, handler: function () { console.log("页面设置(U) menu clicked!") } }, { title: "打印(P)...", shortcut: "Ctrl+P", enabled: !0, handler: function () { console.log("打印(P) menu clicked!") } }, { title: "hr", shortcut: "", enabled: !0, handler: null }, { title: "退出(X)", shortcut: "", enabled: !0, handler: function () { console.log("退出(X) menu clicked!") } }], width: "202px", left: "0px" }, { title: "编辑(E)", menuItems: [{ title: "撤销(U)", shortcut: "Ctrl+Z", enabled: !1, handler: function () { console.log("撤销(U) menu clicked!") } }, { title: "hr", shortcut: "", enabled: !0, handler: null }, { title: "剪切(T)", shortcut: "Ctrl+X", enabled: !0, handler: function () { console.log("剪切(X) menu clicked!") } }, { title: "复制(C)", shortcut: "Ctrl+C", enabled: !1, handler: function () { console.log("复制(C) menu clicked!") } }, { title: "粘贴(P)", shortcut: "Ctrl+V", enabled: !1, handler: function () { console.log("粘贴(P) menu clicked!") } }, { title: "删除(L)", shortcut: "Del", enabled: !1, handler: function () { console.log("删除(L) menu clicked!") } }, { title: "hr", shortcut: "", enabled: !0, handler: null }, { title: "查找(F)...", shortcut: "Ctrl+F", enabled: !1, handler: function () { $dlgSearch.show(function (t) { $editor.search(t) }) } }, { title: "查找下一个(N)", shortcut: "F3", enabled: !1, handler: function () { console.log("查找下一个(N) menu clicked!") } }, { title: "替换(R)...", shortcut: "Ctrl+H", enabled: !0, handler: function () { $dlgReplace.show({ searchHandler: function (t) { $editor.search(t) }, replaceHandler: function (t) { $editor.replace(t) }, replaceAllHandler: function (t) { $editor.replaceAll(t) } }) } }, { title: "转到(G)...", shortcut: "Ctrl+G", enabled: !0, handler: function () { $dlgGoto.show({ lineNum: $editor.getRow(), totalLine: $editor.getTotalLn(), gotoHandler: function (t) { $editor.gotoLn(t) } }) } }, { title: "hr", shortcut: "", enabled: !0, handler: null }, { title: "全选(A)", shortcut: "Ctrl+A", enabled: !0, handler: function () { $editor.selectAll() } }], width: "218px", left: "52px" }, { title: "格式(O)", menuItems: [{ title: "自动换行(W)", shortcut: "", enabled: !0, handler: function () { np.bWrap = !np.bWrap, np.bWrap ? ($statusBar.display(!1), $editor.resize(!1), $menubar.enabled(3, 0, !1), $menubar.enabled(1, 9, !1)) : ($statusBar.display(np.bShowStatusBar), $editor.resize(np.bShowStatusBar), $menubar.enabled(3, 0, !0), $menubar.enabled(1, 9, !0), $menubar.checked(3, 0, np.bShowStatusBar)), $menubar.checked(2, 0, np.bWrap), $editor.setWrap(np.bWrap) } }, { title: "字体(F)...", shortcut: "", enabled: !0, handler: function () { $dlgFont.show({ family: np.fontFamily, style: np.fontStyle, size: np.fontSize, okHandler: np.fontHandler }) } }], width: "156px", left: "106px" }, { title: "查看(V)", menuItems: [{ title: "状态栏(S)", shortcut: "", enabled: !0, handler: function () { np.bShowStatusBar = !np.bShowStatusBar, $statusBar.display(np.bShowStatusBar), $menubar.checked(3, 0, np.bShowStatusBar), $editor.resize(np.bShowStatusBar) } }], width: "138px", left: "162px" }, { title: "帮助(H)", menuItems: [{ title: "查看帮助(H)", shortcut: "", enabled: !0, handler: function () { } }, { title: "关于记事本(A)", shortcut: "", enabled: !0, handler: function () { $dlgAbout.show() } }], width: "166px", left: "216px" }];